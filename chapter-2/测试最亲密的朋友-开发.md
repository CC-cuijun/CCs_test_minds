# 测试最亲密的朋友-开发

&#8195;&#8195;开发是测试同学平日打交道最多的角色，但是你真的了解这个角色吗，你知道他们是怎么开发的吗？当你学习一门编程语言并落地实施一个项目后你就会有真切的感受。

## 学习一些开发知识：
- 能了解在开发人员在哪个环节容易犯错误，知道在哪个逻辑结构、哪个接口或函数，甚至可以发现组件的使用，技术设计上的问题；
- 可以更好地能理解软件产品；
- 可以帮助开发人员快速定位问题；
- 可以了解软件的设计思路；
- 可以编写一些辅助测试的小工具，做自动化，甚至测试框架的开发；

我们看下面看一些bug的例子：
> 配置引发的问题：
```
//            File file = new File("config.properties");
//            BufferedReader IN=new BufferedReader(new InputStreamReader(new FileInputStream(file),"utf-8"));
            InputStream IN = KafkaProducer.class.getClassLoader().getResourceAsStream("config.properties");
```
> 一个for循环的边界值测试： 
```
    list[0] = "子系统个数:" + num;
    var Temp_list = body.slice(2);
 //   for(var i=1;i<num+1;i++) {
    for(var i=0;i<num;i++) {
        var data = {};
        var sysnum = parseInt(Temp_list.slice(0,2),16);
        var wdlist = [];
        for (var j=0;j< tnum; j++){
            wdlist[j] = j+1 + "_" + (parseInt(valuelist.slice(0,2),16)-40);
            valuelist = valuelist.slice(2);
        }
        data.sysnum = sysnum;
        data.wdlist = wdlist;
        list[i] = data ;
    }
```

> 枚举不生效：
```
var responses_type = {
    SUCESS : '01',
    ERROR : '02'
};
var resmsg = command_id + responses_type.SUCCESS + resmsgbody;
```

> 数据库字段设置引发的问题：字段长度设计不够，上线一段时间后导致数据无法写入；    
> 线程安全/非安全：


## 怎样用开发的思维来服务测试呢？

* 测试一定要参与各类设计评审（开发的各种设计文档，数据流图，时序图以及接口文档等）：不是让开发告诉你怎么测试，而是需要从需求和各个设计文档中去考虑我们的测试策略，测试范围，测试用例的设计，以及是否需要测试工具的开发工作；
* 主动了解被测系统架构和所使用的技术；
> 测试人员了解业务/架构设计，清楚业务数据流程以及接口调用时序，可以设计更有针对性的测试用例，可以更精确的确定回归测试范围，而不是纯黑盒的按黑盒测试思维来覆盖测试，可以更精准的定位bug，降低研发过程成本；  
> 契约测试：预先订立契约（如接口文档，kakfa消息），不依赖对方是否完成实际开发，按契约开发，开发完成按约定做联调，做过前端开发的话你就知道只要有接口定义，我的路由可以自己返回数据而不需要真正调用后端服务；
* 了解所测系统使用到到基础服务，如：hbase、kafka、ES、mongoDB、redis等（可以提高bug定位能力，而且大数据测试是一定需要去了解到的，可参见附录：hbase基准测试/ES基准测试）
* 学习gitflow：属于开发规范，也属于质量过程管理中的一环，不合理的分支管理模型会大大增加测试的时间以及交付质量风险；
> gitflow虽然业界有很多玩法，但是这个就像设计模式一样，经过时间沉淀过的流程都是比较靠谱有参考价值的。该踩过的坑人家已经踩过了，为什么要拿自己的成本去试错呢？
* 学习一门编程语言并落地：这是你真正能力切实体会到一个开发过程，怎样挖坑、掉坑又填坑的过程。   
> 测试开发与业务开发一样，如果需求不明确，或者做的东西没有考虑十分周全，后续扩展，bug修改都很麻烦，所以一定要先分析，先设计，当你经历一次真正的开发过程后，你会学到怎样debug，怎样改bug，了解为什么要做配置测试等等，做过之后你甚至可以知道怎样去增强开发的质量和安全意识，为什么要做代码评审，静态代码检查等；  
> 做过开发后，对性能的理解会更深入。曾经很一次有意思的工具开发过程，当时需要开发一个kakfa压测工具，压测开始时服务端性能不行，很快就到了瓶颈，开发优化了几版之后性能瓶颈转移到压测工具上了，结果反过来需要优化压测工具，花了一天时间改造优化工具，优化后性能也是杠杠的。
* 学习一两个开源框架/工具：jmeter/RF，从各种开源代码你可以学到很多的设计思维，看看人家的代码和设计，自己学着写一些RF自定义关键字，测试库，开发自己的jmeter插件，以及源码的二次开发等）
* 学习数据库相关知识（含关系型和非关系型）
* 学习WEB/IOS/Android以及一些嵌入式相关等知识（了解H5，node等）

### 数据库的一些测试总结：
- mysql优化  
  - 表设计的合理性（数据库表结构的优化 ）  
  - 字段类型是否合理（如字段长度设置） 
  - 查询是否添加索引
  - 事务隔离级别是否合理
  - 多表关联查询效率（索引设计，了解索引类型）
  - 是否需要临时表或者视图
  - SQL语句及索引的优化
  - 增加缓存/内存扩容，尽量减少数据库IO
  - 分布式数据库、分布式缓存
  - 关注慢查询
  - explain sql语句
  - 读写分离，主库写，从库读
  - 限定查询范围
  - 表分区
    - 存储更多数据
    - 查询速度
    - 易维护
- 数据库测试
  - 业务数据是否正确保存
  - 设计字段是否合理
  - 数据库/表设计是否合理（关联关系、索引）
  - 备份策略
- 数据库问题排查
  - top查看是否mysqld
  - show processlist
  - session情况
  - 查找线程
  - 连接数
- redis：
  - 缓存 + DB 的读写分离架构
  - 缓存层使用 key-value 的形式来承载大量的读操作
  - DB层数据持久化
- mongoDB
- kafka
- hbase
  - Hbase逐个提交/批量提交（性能）
- ES

### 配置测试

- 配置的修改是否生效（开发忘记读取外部配置，会导致程序读取默认配置，外部配置不生效）
- 配置路径是否规范
- 配置文件是否规范（properties、yaml、json、xml）

### 接口测试
- 接口的参数校验（必填/非必填）
- 返回数据及数据结构
- 返回数据量是否合理
- 请求方法
  - get、post、put、delete
- 接口安全
  - 数据加密
  - 数据脱敏
  - http/https
   - HTTP 直接与 TCP 通信，而 HTTPS 是先与 SSL（加密） 通信，然后再由 SSL 和 TCP 通信（了解下中间人攻击）
- 业务逻辑（涉及接口调用时序图）
- 性能（响应时间、TPS、错误率等）
- 接口类型
  - http/webservices
- HTTP 请求头
  - Host, 请求的域名
  - User-Agent 用户的浏览器版本信息 
  - Accept 响应的内容类型 
  - Accept-Language 接受的语言 
  - Accept-Encoding 可接受的编码方式 
  - Cookie 本地Cookie信息 
  - if-Modified-Since 缓存
  - Content-Type
  - Connection
  - etc.
 - Cookie和Session的区别：Session是存储在服务器端的，Cookie是存储在客户端的。

### 自动化测试（不展开，后续可做专题分享）

* 思考自动化的目的
* 思考怎样让自动化产生价值
* 思考怎样去做（怎样算好的自动化框架）

### 测试开发（不展开，后续做专题分享）
- 测试工具开发
- 自动化脚本及框架开发
  - 框架选型
  - 基础框架开发
  - 数据层设计
  - 业务逻辑设计
  - 测试脚本
  - 测试报告

### 白盒测试
- 单元测试
- 代码走查/代码评审
- 基本路径覆盖法
- 动态检查
  - debug
  - 模拟方法入口
- 静态代码检查
